<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>
      Greg Burek - 
      Rate Limiting Function Calls in Python with a Decorator
      
    </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="x-B-7Gh5W7YevI09T48-S4on8MkU9MjG-6XD7aurE7Y" />

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <link href="../../../../css/normalize.css" rel="stylesheet" type="text/css" />
    <link href="../../../../css/main.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="//use.typekit.net/aab1psy.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <script src="../../../../js/vendor/modernizr-2.6.1.min.js" type="text/javascript"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
  </head>
  <body class="x2011 x2011_12 x2011_12_05 x2011_12_05_Rate-limiting-with-decorators x2011_12_05_Rate-limiting-with-decorators_index">
    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
    <![endif]-->

    <header>
  <div class="container">
    <h1>
      <a href="../../../../">Greg Burek</a>
    </h1>
    <nav>
  <ul>
    <li>
      <a href="../../../../about/">About</a>
    </li>
    <li>
      <a href="../../../../">Writing</a>
    </li>
  </ul>
</nav>

  </div>
</header>


    <div class="container">
        <article class="writing">
    <h1>Rate Limiting Function Calls in Python with a Decorator</h1>
    <div class="article-details">
      <div class="article-date">
        <i class="fa fa-calendar-o"></i>
        2011-12-05
        <div class="tags">
          tags:
        </div>
      </div>
    </div>
    <p>source: <a href="http://stackoverflow.com/a/667706/586172">Stack Overflow &ldquo;What&rsquo;s a good rate limiting algorithm?&rdquo;</a></p>

<p>I making this into a post because I have found it so handy. Some web
APIs have rate limits on requests per minute or you may want to play nice
and not overwhelm the service. In Python, you can use this decorator to
rate limit a function that may handle the API access: </p>
<pre class="highlight python"><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">RateLimited</span><span class="p">(</span><span class="n">maxPerSecond</span><span class="p">):</span>
    <span class="n">minInterval</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">maxPerSecond</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">lastTimeCalled</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">rateLimitedFunction</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">lastTimeCalled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">leftToWait</span> <span class="o">=</span> <span class="n">minInterval</span> <span class="o">-</span> <span class="n">elapsed</span>
            <span class="k">if</span> <span class="n">leftToWait</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">leftToWait</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="n">lastTimeCalled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">return</span> <span class="n">rateLimitedFunction</span>
    <span class="k">return</span> <span class="n">decorate</span>

<span class="nd">@RateLimited</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c"># 2 per second at most</span>
<span class="k">def</span> <span class="nf">PrintNumber</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"This should print 1,2,3... at about 2 per second."</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">PrintNumber</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre>

<p>This answer is simpler than setting up a queue system and is blocking,
which can be good for sequential jobs. </p>

  </article>

    </div>

    <footer>
  <div class="container">
    <ul class="social-nav">
      <li>
        <a href="https://twitter.com/gregburek">
          <i class="fa fa-twitter-square"></i>
        </a>
      </li>
      <li>
        <a href="../../../../feed.xml"><i class="fa fa-rss-square"></i></a>
      </li>
    </ul>
    <nav>
  <ul>
    <li>
      <a href="../../../../about/">About</a>
    </li>
    <li>
      <a href="../../../../">Writing</a>
    </li>
  </ul>
</nav>

  </div>
</footer>

    <script src="../../../../js/plugins.js" type="text/javascript"></script>
    <script src="../../../../js/ga.js" type="text/javascript"></script>
  </body>
</html>
