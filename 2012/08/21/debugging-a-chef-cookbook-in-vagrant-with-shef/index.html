<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>
      Greg Burek - 
      Debugging a chef cookbook in vagrant with shef
      
    </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="x-B-7Gh5W7YevI09T48-S4on8MkU9MjG-6XD7aurE7Y" />
    <meta name="google-site-verification" content="hzWlqDEbM4CUsiEb8YrcUdovSZSNx6jySbQkjRXyCCk" />

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <link href="/stylesheets/all.css" rel="stylesheet" />
    <script type="text/javascript" src="//use.typekit.net/rtf4ikk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <script src="/js/vendor/modernizr-2.6.1.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-22983311-2"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </head>
  <body class="x2012 x2012_08 x2012_08_21 x2012_08_21_debugging-a-chef-cookbook-in-vagrant-with-shef x2012_08_21_debugging-a-chef-cookbook-in-vagrant-with-shef_index">
    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
    <![endif]-->

    <header>
  <div class="container">
    <h1>
      <a href="../../../../">Greg Burek</a>
    </h1>
  </div>
</header>


    <div class="container">
        <article class="writing">
    <h1>Debugging a chef cookbook in vagrant with shef</h1>
    <div class="article-details">
      <div class="article-date">
        <i class="fa fa-paper-plane-o"></i>
        August 21, 2012
        <div class="tags">
          tags:
            <a href="/tags/chef/">chef</a>,
            <a href="/tags/debugging/">debugging</a>,
            <a href="/tags/shef/">shef</a>,
            <a href="/tags/testing/">testing</a>,
            <a href="/tags/vagrant/">vagrant</a>
        </div>
      </div>
    </div>
    <p>Sometimes <a href="http://vagrantup.com" title="Vagrant - Virtualized development for
the masses">Vagrant</a>&rsquo;s provisioning error messages can be a little cryptic.</p>

<p></p>

<p>When troubleshooting a failing chef-solo run, tweaking a <code>run_list</code> or
debugging a new recipe, I&rsquo;ve found it very handy to log into the partially
provisioned VM with <code>vagrant ssh</code> and then run: <a href="http://vagrantup.com" title="Vagrant - Virtualized development for the masses">Vagrant</a> is a great tool for
developing and testing new chef cookbooks. After bringing up a new vm, and
editing a cookbook,<code>vagrant provision</code> runs the chef-solo provisioner and tests
things out. However, when things fail, vagrant&rsquo;s provisioning error messages
can be a little cryptic. <a href="http://wiki.opscode.com/display/chef/Shef" title="Shef
- Chef - Opscode Open Source Wiki">Shef</a> is a good tool for running cookbooks in
isolation, but it needs some help to find all the configuration and attributes
that vagrant provides. If my <code>new_and_broken</code> cookbook is failing on a Ubuntu
12.04 VM, all I need to do is run:</p>
<pre class="highlight plaintext"><code>$ shef -s -c /tmp/vagrant-chef-1/solo.rb -j /tmp/vagrant-chef-1/dna.json
    (output snip)
chef &gt; recipe
chef:recipe &gt; include_recipe 'new_and_broken'
    (huge output snip)
chef:recipe &gt; run_chef
    (where the error happens)
</code></pre>
<p>This loads shef in solo mode, with vagrant generated configuration and JSON
attributes files, enters into recipe mode, loads my new and broken cookbook and
runs it. The resulting error messages are usually more helpful than <code>vagrant
provision</code> and I can get back to work. </p>

  </article>

    </div>

    <footer>
  <div class="container">
    <ul class="social-nav">
      <li>
        <a href="https://twitter.com/gregburek">
          <i class="fa fa-twitter-square"></i>
        </a>
      </li>
       <li>
        <a href="https://github.com/gregburek">
          <i class="fa fa fa-github-square"></i>
        </a>
      </li>
      <li>
        <a href="http://lanyrd.com/profile/gregburek/">
          <i class="fa fa fa-map-marker"></i>
        </a>
      </li>
      <li>
        <a href="http://www.linkedin.com/in/gregburek">
          <i class="fa fa fa-linkedin-square"></i>
        </a>
      </li>
      <li>
      <a href="http://www.flickr.com/photos/gregburek/">
          <i class="fa fa fa-flickr"></i>
        </a>
      </li>
     <li>
        <a href="../../../../feed.xml"><i class="fa fa-rss-square"></i></a>
      </li>
    </ul>
    <nav>
      <ul>
        <li>
        <a href="../../../../about/">About</a>
        </li>
        <li>
        <a href="/tags/">Tags</a>
        </li>
      </ul>
    </nav>
  </div>
</footer>

    <script src="/js/plugins.js"></script>
  </body>
</html>
